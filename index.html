// js/app.js

// After the function show(page) { ... }
window.show = show;

// After the function async function searchBrreg(){ ... }
window.searchBrreg = searchBrreg;

// Add the new functions near the list-related functions, e.g. before async function renderDashboard(){ ... }

async function openFromList(listId, index){
  try{
    const { data:list, error } = await supabase.from('lists').select('*').eq('id', listId).single();
    if(error){ console.error(error); toast('Kunne ikke åpne liste'); return }
    const it = list.items[index];
    if(!it){ return }
    document.getElementById('orgnr').value = it.Orgnummer || '';
    document.getElementById('navn').value = it.Navn || '';
    document.getElementById('besoksadresse').value = it.Gateadresse || '';
    document.getElementById('besoks_postnr').value = it.Postnr || '';
    document.getElementById('besoks_poststed').value = it.Poststed || '';
    show('kontroll');
    const n = String(it.Orgnummer || '').replace(/\D/g,'');
    if(n.length===9){
      try{
        const r = await fetch('https://data.brreg.no/enhetsregisteret/api/enheter/'+n);
        if(r.ok){
          const d = await r.json();
          const a = d.forretningsadresse || d.beliggenhetsadresse || {};
          document.getElementById('besoks_postnr').value = a.postnummer || '';
          document.getElementById('besoks_poststed').value = a.poststed || '';
          document.getElementById('firma').value = d.navn || '';
        }
      }catch(e){ console.error(e) }
    }
  }catch(e){ console.error(e) }
}
window.openFromList = openFromList;

async function deleteList(listId){
  if(!confirm('Slette hele listen?')) return;
  try{
    const { error } = await supabase.from('lists').delete().eq('id', listId);
    if(error){ console.error(error); toast('Kunne ikke slette liste'); return }
    toast('Liste slettet');
    await renderDashboard();
  }catch(e){ console.error(e); toast('Kunne ikke slette liste'); }
}
window.deleteList = deleteList;

// In the renderDashboard function, replace box.innerHTML= block header as specified:

// Find this existing code block:
box.innerHTML=`
  <div class="list-header">
    <span style="cursor:default">${sanitize(L.name)}</span>
    <small>${new Date(L.created_at).toLocaleDateString('nb-NO')}</small>
  </div>
  <div class="list-scroll">
    <table class="list-table">
      ...

// Replace with:
box.innerHTML=`
  <div class="list-header">
    <span style="cursor:default">${sanitize(L.name)}</span>
    <div style="display:flex;align-items:center;gap:8px">
      <small>${new Date(L.created_at).toLocaleDateString('nb-NO')}</small>
      <button class="btn-tiny" title="Slett hele listen" onclick="deleteList('${L.id}')">Slett liste</button>
    </div>
  </div>
  <div class="list-scroll">
    <table class="list-table">
      ...

// Also inside renderDashboard, replace the <td> with the long inline onclick IIFE button with:

<td>
  <button class="btn-tiny" title="Åpne i skjema" onclick="openFromList('${L.id}', ${i})">${sanitize(it.Navn||'Åpne')}</button>
</td>

// Remove the previous long inline JavaScript in that cell.
